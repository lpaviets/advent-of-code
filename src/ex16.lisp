(in-package #:aoc2021/ex16)

(defclass packet ()
  ((version
    :initarg :version
    :accessor version)
   (type-id
    :initarg :type-id
    :accessor type-id)))

(defclass lit-packet (packet)
  ((value
    :initarg :value
    :accessor value)))

(defclass op-packet (packet)
  ((type-length
    :initarg :type-length
    :accessor type-length)
   (subpackets
    :initarg :subpackets
    :accessor subpackets)))

(defun hex-to-bin-string (string)
  (format nil "船О恂祜镳烘矧烘蝻衡屐秣戾铉翳篝蜷铉恒镬戾泗疳蝮瀛轭翦珏篝蜷铉后翎螋哄钿ū椹候徜轼倍┅┅ㄤ彐躅汜瞽篝殪飙蝈徜疳汶弭篝蜷铉痫螬戾è戾铉翳戾铉翳篝蜷铉┅ㄡ钿ǐ痫珐戾铉翳痫箝糸镱＼篝蜷铉后翎螋痫螬┅ㄤ彐躅蝈徜桢疳汶弭篝蜷铉痫螬蝈徜疳汶弭ㄨ屮麸忾瞽篝蜷铉篝蜷铉痫螬ㄤ彐躅蝈徜疳汶弭篝蜷铉痫螬⒁弭躜赭鲠祯弩澡骈蝮镱轶翳疳汶弭蝈徜轭釉疑吻篝狎糸铉狒痫箝糸镱邢赢澡箦泔钿轶翳痫箝糸镱镦翳灬篝忾蝈徜戾è鲥蝮轱疳蝮瀛轭翦珏篝蜷铉后翎螋痫哄钿ǐ痫畅候徜轼博豉疱殇疳蝮瀛轭翦珏篝蜷铉后翎螋ǐ痫畅哄钿ǐ痫订候徜轼博┅眭祠轲戾鲠祯瀛忾钿疳汶弭骈钺飙痫螬ㄣ狍豉疱殇ù蝈徜扉舡疳汶弭篝蜷铉痫螬蝈徜镳疳汶弭篝蜷铉痫螬┅鏖翳徙沐篌矧è鲥鲥蝮轱瞟豉疱豉疱殇┅疳汶弭箦翩鲥鲥蝮轱瞟箦翩豉疱豉疱殇┅鲠祯弩疳汶弭骈钺飙痫螬┅ㄤ彐躅蝈徜疳汶弭扉篝篝蜷铉痫脲泔躅戾铉翳⑻轶镦疳汶弭镡翎轭邃骝镯蝈徜轭翳忾钺蝙篝蜷铉釉疑吻骝镯翳篝狎糸铉痫箝糸镱邢涉孟瘴轶铒瞽铋飕蝈徜屮徙綮孟瘴疳汶弭涉膛吻匀轶铒瞽铋飕蝈徜狒盹篝膛吻匀忾趔骝镯邢涉怙翳狎紊态蝈徜翳麒镬篝蜷铉骝镯邢深犷汜箦犰箫蝈趱蝾箦泔钿鲠祯瀣麒殂轶翳痫箝糸镱镦翳骈钺忾蝈徜轭釉疑吻祜镳瑚轸戾铉翳篝蜷铉戾铉翳篝蜷铉瑚轸骈钺飙痫痫烘矧铛烘蝻瑚栝戾ㄡ钿ㄣ犷篝殪飙蝈徜疳汶弭篝蜷铉ū骈钺飙痫螬矧铒泔躅舂铛泔躅舂矧铒戾铉翳ō骈钺飙痫痫螬ū戾铉翳┅┅烘矧疳汶弭铄鳝痫螬眭祠轲戾鲠祯瀛扉篝蝈徜疳汶弭篝蜷铉痫螬呼桢眭祠轲戾鲠祯瀛扉篝蝈徜疳汶弭篝蜷铉ū骈钺飙痫螬┅轰箦翩骈钺飙痫铄鳝痫螬恒镬戾泗疳汶弭洪铘疳汶弭烘轭犰禊蝈趱蝾鲠祯弩疳汶弭骈钺飙痫螬┅ㄤ彐躅蝈徜扉舡疳汶弭篝蜷铉痫螬⒁遽扉翦蜥疳汶弭渝囹遽洵疳汶弭骝镯篝蜷铉Б祜镳烘矧忪镢氕篝狎烘蝻ǐ痫订衡恒镬戾泗疳蝮瀛轭翦珏篝蜷铉后翎螋ū忪镢氕篝狎舂哄钿ǐ忪镢氕篝狎舂候徜轼博洪铘忪镢塍乎铘殪ㄣ栳蚪ㄣ栳篝蜷铉忪镢氕篝狎舂＼癌烘轭犰禊戾舄è骈钺飙痫ǐ忪镢氕篝狎穿扉舡篝蜷铉ㄦ矧磲铋船О恂忪镢塍┅扉舡鲠疳蝮瀛轭翦珏扉舡篝蜷铉候徜轼博疳汶弭磲脲轭篝犷沐ъ轸疳汶弭忽犰蹂扉舡鲠飑┅蝈趱蝾鲠祯弩疳汶弭骈钺飙痫螬┅┅ㄤ彐躅蝈徜镳疳汶弭篝蜷铉痫螬⒁遽犷镳弪狒矧疳汶弭拈箴狒汨弩麸赭雉桢骢钽糸镱徙泔蜾轭麸翳戾铉翳豉疱殇渝囹遽洵疳汶弭Б戾è戾铉翳豉疱殇ㄩㄣ栳蚪ㄣ栳篝蜷铉ǐ痫订＼暴癌┅眭祠轲戾鲠祯瀛忾钿疳汶弭骈钺飙痫螬ㄩ弪镳戾铉翳豉疱殇蝈徜镳疳汶弭篝蜷铉痫螬蝈徜镳疳汶弭篝蜷铉痫螬箦翩豉疱戾铉翳疳汶弭戾铉翳豉疱殇鲠祯弩疳汶弭骈钺飙痫螬┅ㄤ彐躅蝈徜镳疳汶弭篝蜷铉痫螬⒁遽犷镳弪狒矧疳汶弭镦戾铉翳豉疱赡爱渝囹遽洵疳汶弭Б戾舄è戾铉翳篚怵徙脲趔疳蝮瀛轭翦珏篝蜷铉后翎螋ǐ痫珐哄钿ǐ痫钡候徜轼博篚怵徙脲趔犷洵痫眭祠轲戾鲠祯瀛扉篝蝈徜疳汶弭扉篝篝蜷铉ǐ痫钡红孱玺戾铉翳篚怵徙脲趔┅篚怵徙脲趔ㄦ轵篝篚怵徙脲趔犷洵痫螬ㄦ轭犰痫箦泔钿篚怵徙脲趔犷洵痫螬疳汶弭磲脲轭篝犷沐э瓠疳汶弭后踱疳汶弭篚怵徙脲趔┅鲠祯弩疳汶弭骈钺飙痫螬┅ㄤ彐躅蝈徜镳疳汶弭篝蜷铉痫螬⒁遽犷镳弪狒矧疳汶弭镦戾铉翳豉疱赡碑渝囹遽洵疳汶弭Б戾舄è泔躅舡篚怵徙脲趔疳蝮瀛轭翦珏篝蜷铉后翎螋ǐ痫珐哄钿ǐ痫北候徜轼博篚怵徙脲趔犷洵痫眭祠轲戾鲠祯瀛扉篝蝈徜疳汶弭扉篝篝蜷铉ǐ痫北恒秕铘泔躅舡篚怵徙脲趔┅篚怵徙脲趔ㄦ轵篝篚怵徙脲趔犷洵痫螬ㄦ轭犰痫箦泔钿篚怵徙脲趔犷洵痫螬疳汶弭磲脲轭篝犷沐э瓠疳汶弭后踱疳汶弭篚怵徙脲趔┅鲠祯弩疳汶弭骈钺飙痫螬┅ㄤ彐礤翳镤篚憝疳汶弭蟓鲥蝮轱è疳汶弭扉舡疳汶弭┅鲥蝮轱疳汶弭┅ㄤ彐礤翳镤篚憝疳汶弭蟓鲥蝮轱è疳汶弭镳疳汶弭┅ㄡ痧禊Й鲥蝮轱疳汶弭磲疸狎篚憝疳汶弭蟓鲥蝮轱篚怵徙脲趔疳汶弭┅┅换嗅螋ㄤ彐礤翳镤镳弪狒è疳汶弭扉舡疳汶弭镳糸镱犰ㄤ屦翳癌溴怩绌麒孱溴怩ㄤ雉轫弩ㄩ溴痿瑭ㄦ矧磲Ⅻ┅ㄦ矧磲⒅犰蹂狺ア鲠祯疳汶弭┅鲠祯疳汶弭┅ㄤ彐礤翳镤镳弪狒è疳汶弭镳疳汶弭镳糸镱犰ㄤ屦翳癌溴怩绌麒孱溴怩ㄤ雉轫弩ㄩ溴痿瑭ㄦ矧磲Ⅻ┅戾舄è篚怵徙脲趔篚怵徙脲趔疳汶弭┅镳豉疱殇疳汶弭┅鲠ㄩ镳穿戾è骢ㄣ狍镳òЙūИúы轭ǔы狲┅┅麒孱溴怩ㄦ矧磲⒘痧禊轭麸湖ア骢瞟ㄡ痧禊骢磲疸狎灬礅溽镳弪狒ū溴痿瑭溴怩绌篚怵徙脲趔┅戾è骢ㄣ狍镳ǖЬǘЪǚЫ┅┅麒孱溴怩ㄦ矧磲⒘痧禊轭麸湖ア骢瞟ㄩㄡ痧禊骢磲疸狎灬礅溽镳弪狒ū溴痿瑭溴怩绌篚怵徙脲趔┅癌┅┅麒孱溴怩ㄤ雉轫弩ㄩ溴痿瑭ㄦ矧磲Ⅻ┅ㄦ矧磲⒁弩蹯艉狺ア鲠飑鲠飑ㄤ彐躅犷篦弪屮倍ī戾舄è扉铄ㄣ狎蝈徜骈戾狍扉铄轭瘐趔轭瘐舯懂豇簪┅疳汶弭蝈徜桢疳汶弭扉铄癌┅篚憝疳汶弭蟓鲥蝮轱疳汶弭┅ㄤ彐躅犷篦弪屮倍ī戾舄è扉铄ㄣ狎蝈徜骈戾狍扉铄轭瘐趔轭瘐舯懂豇簪┅疳汶弭蝈徜桢疳汶弭扉铄癌┅镳弪狒疳汶弭舂┅